<div class="list-header special-table-header">
  <mat-icon>filter_list</mat-icon>

  <mat-form-field appearance="outline" class="special-form-field">
    <mat-label>{{ 'userList.role' | transloco }}</mat-label>
    <mat-select [(value)]="selectedRole">
      <mat-option *ngFor="let r of roleList" [value]="r">
        {{ 'userList.role' + r.charAt(0) + r.slice(1).toLowerCase() | transloco }}
      </mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="outline" class="special-form-field">
    <mat-label>{{ 'userList.casesCount' | transloco }}</mat-label>
    <input matInput type="number" [(ngModel)]="casesCountFilter" />
  </mat-form-field>
  <button mat-stroked-button class="special-clear-button" (click)="clearFilters()">
    <mat-icon>clear_all</mat-icon>
    {{ 'caseList.clearFilters' | transloco }}
  </button>

  <span class="spacer"></span>

  <button
    mat-icon-button
    class="special-icon-button"
    [ngClass]="{ active: viewMode === 'table' }"
    (click)="viewMode = 'table'"
  >
    <mat-icon>view_list</mat-icon>
  </button>
  <button
    mat-icon-button
    class="special-icon-button"
    [ngClass]="{ active: viewMode === 'grid' }"
    (click)="viewMode = 'grid'"
  >
    <mat-icon>grid_view</mat-icon>
  </button>
</div>

@if (filteredUsers().length === 0) {
  <div class="no-results-container">
    <mat-card class="no-results-card mat-elevation-z6">
      <mat-icon class="no-results-icon" color="warn">search_off</mat-icon>
      <h2>{{ 'caseList.noResultsTitle' | transloco }}</h2>
      <p>{{ 'caseList.noResultsText' | transloco }}</p>
    </mat-card>
  </div>
}

@if (viewMode === 'table' && filteredUsers().length > 0) {
  <div class="scrollable-table">
    <div class="special-table">
      <table mat-table [dataSource]="filteredUsers()" class="special-mat-table">
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>{{ 'userList.actionUser' | transloco }}</th>
          <td mat-cell *matCellDef="let u">
            @if (canDeleteUser(u)) {
              <button mat-icon-button (click)="openDialog(u.userId)">
                <mat-icon fontIcon="delete"></mat-icon>
              </button>
            }
          </td>
        </ng-container>
        <!--    firstName-->
        <ng-container matColumnDef="firstName">
          <th mat-header-cell *matHeaderCellDef>{{ 'userList.firstName' | transloco }}</th>
          <td mat-cell *matCellDef="let u">{{ u.firstName }}</td>
        </ng-container>
        <!--    lastName-->
        <ng-container matColumnDef="lastName">
          <th mat-header-cell *matHeaderCellDef>{{ 'userList.lastName' | transloco }}</th>
          <td mat-cell *matCellDef="let u">{{ u.lastName }}</td>
        </ng-container>
        <!--    email-->
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef>{{ 'userList.email' | transloco }}</th>
          <td mat-cell *matCellDef="let u">{{ u.email }}</td>
        </ng-container>
        <!--    role-->
        <ng-container matColumnDef="role">
          <th mat-header-cell *matHeaderCellDef>{{ 'userList.role' | transloco }}</th>
          <td mat-cell *matCellDef="let u">
            <ng-container *ngFor="let r of u.role; let last = last">
              {{ 'userList.role' + r.name.charAt(0) + r.name.slice(1).toLowerCase() | transloco }}
              @if (!last) {
                <span>, </span>
              }
            </ng-container>
          </td>
        </ng-container>
        <!--    nrCases-->
        <ng-container matColumnDef="casesCount">
          <th mat-header-cell *matHeaderCellDef>{{ 'userList.casesNr' | transloco }}</th>
          <td mat-cell *matCellDef="let u">{{ u.casesCount }}</td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
      <mat-paginator
        [length]="userService.totalUsersSignal()"
        [pageSize]="userService.getPageSize()"
        [pageIndex]="userService.getPageIndex()"
        [pageSizeOptions]="[5, 15, 50]"
        (page)="onPageChange($event)"
      ></mat-paginator>
    </div>
  </div>
}

@if (viewMode === 'grid' && filteredUsers().length > 0) {
  <div class="scrollable-list">
    <div class="list-grid">
      <mat-card *ngFor="let u of filteredUsers()" class="user-card mat-elevation-z4">
        <div class="user-header">
          <div>
            <h3>{{ u.firstName }} {{ u.lastName }}</h3>
            <p class="subtitle"> {{ 'userList.email' | transloco }}: {{ u.email }} </p>
          </div>
          @if (canDeleteUser(u)) {
            <button mat-icon-button class="delete-user-btn" (click)="openDialog(u.id)">
              <mat-icon color="warn">delete</mat-icon>
            </button>
          }
        </div>

        <div class="card-body">
          <div>{{ 'userList.casesNr' | transloco }}: {{ u.casesCount }}</div>
          <div class="chip-row">
            <ng-container *ngFor="let r of u.role">
              <mat-chip [ngClass]="roleClass(r.name)">
                {{ 'userList.role' + r.name.charAt(0) + r.name.slice(1).toLowerCase() | transloco }}
              </mat-chip>
            </ng-container>
          </div>
        </div>
      </mat-card>
    </div>
    <mat-paginator
      [length]="userService.totalUsersSignal()"
      [pageSize]="userService.getPageSize()"
      [pageIndex]="userService.getPageIndex()"
      [pageSizeOptions]="[5, 15, 50]"
      (page)="onPageChange($event)"
    ></mat-paginator>
  </div>
}
